'use server';
/**
 * @fileOverview Enhances the prompt used for classifying images for potential steganography.
 *
 * - enhancePrompt - A function that enhances the prompt based on user input.
 * - EnhancePromptInput - The input type for the enhancePrompt function.
 * - EnhancePromptOutput - The return type for the enhancePrompt function.
 */

import {ai} from '@/ai/genkit';
import {z} from 'genkit';

const EnhancePromptInputSchema = z.object({
  originalPrompt: z
    .string()
    .describe('The original prompt used for malware classification.'),
  enhancementInstructions: z
    .string()
    .describe(
      'Instructions on how to enhance the original prompt. Be specific about what aspects to improve or focus on.'
    ),
});
export type EnhancePromptInput = z.infer<typeof EnhancePromptInputSchema>;

const EnhancePromptOutputSchema = z.object({
  enhancedPrompt: z
    .string()
    .describe('The enhanced prompt, refined based on the given instructions.'),
});
export type EnhancePromptOutput = z.infer<typeof EnhancePromptOutputSchema>;

export async function enhancePrompt(input: EnhancePromptInput): Promise<EnhancePromptOutput> {
  return enhancePromptFlow(input);
}

const prompt = ai.definePrompt({
  name: 'enhancePromptPrompt',
  input: {schema: EnhancePromptInputSchema},
  output: {schema: EnhancePromptOutputSchema},
  prompt: `You are an expert prompt engineer specializing in refining prompts for image analysis, specifically for detecting steganography.

You will receive an original prompt and instructions on how to enhance it. Your goal is to create an enhanced prompt that is more effective at detecting hidden content in images or reducing false positives, based on the instructions provided.

Original Prompt: {{{originalPrompt}}}
Enhancement Instructions: {{{enhancementInstructions}}}

Please provide the enhanced prompt:
`,
});

const enhancePromptFlow = ai.defineFlow(
  {
    name: 'enhancePromptFlow',
    inputSchema: EnhancePromptInputSchema,
    outputSchema: EnhancePromptOutputSchema,
  },
  async input => {
    const {output} = await prompt(input);
    return output!;
  }
);
